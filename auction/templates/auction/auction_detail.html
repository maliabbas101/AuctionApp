{% extends 'base.html' %}
{% load static %}
{% block scripts %}
{% load tags %}
<script src={% static 'main.js' %} defer></script>
{% endblock scripts %}

{% block content %}



<div class="container">
  <div class="row">
    {% if request.user.groups.first|is_buyer %}
    <div class="col-lg-9">
    {% elif request.user.groups.first|is_seller %}
    <div class="col-lg-12">
    {% endif %}
        <h1 class="text-center">More About the Auction</h1><hr>
        <div class="row">
          <div class="col-6">
            <div id="event-box" class="text-center bg-success rounded-pill p-1 my-3" style="--bs-bg-opacity: .6;">
              <h4>End Time: {{ auction.end_time|date:"D d M Y" }} {{auction.end_time|time:"H:i" }}</h4>

            </div>
          </div>
          <div class="col-6">
            <div class="text-center bg-danger rounded-pill p-1 my-3" style="--bs-bg-opacity: 1; color: white;" id="countdown-box" >
            </div>
          </div>

        </div>
        <div class="card">
          <div class="row">
            <div class="col-6">
              <img src="{{auction.product.image_set.first.image.url}}" alt="" class="m-3" style="height: 30vw; width: 45vh;"alt="">
            </div>
            <div class="col-6 p-4">
              <h2>{{auction.product.title}}</h2><hr>
              <h5 class="card-title">Owner: {{auction.product.auctionuser}}</h5>
              <h5>Highest Bid: {{auction.product.starting_price}} $</h5>
              <h5 class="card-text"> Description:</h5><p>{{auction.product.description}}</p>
              <a href="{% url 'home' %}" class="btn btn-outline-danger my-5 rounded-pill p-3">Back</a>
              {% if auction.status|is_expired %}
              <div id="winner-text">
                Winner is: {{winner}} with the bid amount: {{highest_bid}}
              </div>
              {% else %}
                {% if request.user.groups.first|is_buyer %}
                <div id="bid-form">
                  <form action="" method="POST" class="btn-block">
                    {% csrf_token %}
                    <input hidden type="text" name="auction" value="{{auction.id}}" />
                    <input hidden type="text" name="user" value="{{request.user.id}}" />
                    <div class="form-group mt-3 mb-3">
                      <ul>
                        <li>
                          <p>Enter your amount or press the bid button to place a bid automatically of 20% higher than current bid</p>
                        </li>
                      </ul>
                      <label for="bid-amount">Bid Amount</label>
                      <input
                        id="bid-amount"
                        class="form-control"
                        type="number"
                        name="bid_amount"
                        value={{auction.product.starting_price|new_bid_amount}}
                        min="{{auction.product.starting_price|min_bid_amount}}"
                        step="0.02"
                      />
                    </div>
                    <input
                      type="submit"
                      id="bid-button"
                      class="float-right btn btn-outline-success rounded-pill p-3"
                      value="Bid"
                    />
                  </form>
                </div>
                {% endif %}
              {% endif %}
            </div>
          </div>
        </div>
        <div class="d-flex justify-content-center">
        </div>
    </div>
    {% if request.user.groups.first|is_buyer %}

    <div class="col-lg-2 ms-5">
      <div class="card border-success mt-4">
        <div class="card-header">
          <h4>Your bids</h4>
        </div>
        <div class="card-body">
          {% for bids in user_bids  %}

            <p>{{forloop.counter}}<strong> . {{bids.bid_amount|round_off}}</strong></p><hr>
          {% endfor %}
        </div>
      </div>
    </div>
    {% endif %}
  </div>
</div>
{% endblock  %}
